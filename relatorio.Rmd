---
title: "Carcinoma do endométrio do corpo uterino"
author: "Duarte Velho(pg53841), Joana Lopes(pg53498), João Ferreira(pg52182), Ricardo Oliveira(pg53501)"
output:
  html_document: default
  pdf_document: default
---
<style>
  p {
    text-align: justify;
  }
</style>

# 1ª Parte- Exploração inicial dos dados e análise de expressão diferencial e de enriquecimento

```{r,echo=FALSE,results='hide', warning = FALSE, message=FALSE, warning = FALSE, message=FALSE}
#install.packages("jpeg")
#install.packages("TCGAbiolinks")
#install.packages("Biobase")
#install.packages("DESeq2")
#install.packages("ggbeeswarm")
#install.packages("genefilter")
#install.packages("pheatmap")
#install.packages("org.Hs.eg.db")
#install.packages("fgsea")
#install.packages("ggplot2")
#install.packages("xfun")
#install.packages("SummarizedExperiment") 
#install.packages("factoextra")
#install.packages("Rtsne")
#install.packages("EBImage")
```

```{r,echo=TRUE,results='hide', warning = FALSE, message=FALSE,warning = FALSE, message=FALSE}
library("jpeg")
#library("TCGAbiolinks")
library("SummarizedExperiment")
#library("DESeq2")
#library("Biobase")
#library("DESeq2")
#library("ggbeeswarm")
#library("pheatmap")
#library("org.Hs.eg.db")
#library("fgsea")
#library("ggplot2")
#library("factoextra")
#library("limma")
#library("genefilter")
#library("Rtsne")
#library("party")
#library("rpart")
#library("caret") 
#library("rsample")

```

## Enquadramento

Nos dias de hoje, o cancro é uma das principais causas de morte a nível mundial, sendo que, segundo a Organização Mundial da Saúde (OMS), em 2020, foram diagnosticados cerca de 19,3 milhões de novos casos de cancro e provocou a morte de aproximadamente 10 milhões de pessoas [1]. O preocupante aumento da incidência do cancro ao longo das ultimas décadas levou ao surgimento de iniciativas, tal como a PanCancer Atlas, que visam encontrar respostas para as grandes e abrangentes questões sobre o cancro, através da análise de tumores caracterizados no conjunto de dados resultantes do projeto de The Cancer Genome Atlas (TCGA).
O TCGA é um programa de genómica de referência na área do cancro que, em colaboração com o Instituto Nacional do Cancro (NCI) e o Instituto Nacional de Pesquisa do Genoma Humano (NHGRI) dos Estados Unidos, caracterizou mais de 20 mil cancros primários abrangendo 33 tipos de cancro. Os tipos de cancro selecionados para estudo cumprem requisitos tais como ter um mau prognóstico, ter um impacto geral na saúde pública, disponibilidade de amostras com a qualidade e quantidade desejadas, entre outros. (National Cancer Institute, 2022)

O cancro endométrico do corpo uterino, um dos cancros incluídos no TCGA, é o sétimo tumor maligno mais frequente no mundo e o quarto mais comum na mulher sendo a doença ginecológica maligna prevalente tendo provocado em 2011 mais de 8 mil mortes [2,3]. De todos os cancros do corpo uterino mais de 83% correspondem a carcinomas endométrico, enquanto apenas 10% dos diagnósticos são classificados como sarcomas [2]. Este tipo de cancro tem ganhando maior atenção por parte da comunidade científica, uma vez que se verificou um aumento da sua incidência com a agravante de que a taxa de sobrevivência aos 5 anos é consideravelmente menor que em 1975 passando de 88% para cerca de 84% em 2006 indicando um aumento na mortalidade [3].
A taxa de sobrevivência está fortemente correlacionada com o estádio da doença aquando do diagnóstico, sendo que para pacientes no estádio inicial se considera curável atingindo cerca de 96% de sobrevivência, no entanto para fases mais avançadas e de alto grau e considerado letal reduzindo drasticamente a taxa de sobrevivência de 96 para 17%.(Costa & Cunha, n.d.)

```{r,echo=FALSE,results= 'markup', fig.cap= "Fig 1- Anatomia do sistema reprodutor feminino (Adaptdado de National Cancer Institute)",fig.align='center'}
image=readJPEG("cancro_endometrico.jpg")

plot(0, 0, type = "n", xlim = c(0, 1), ylim = c(0, 1), xlab = "", ylab = "", axes= FALSE)
rasterImage(image, 0, 0, 1, 1)
```
Tendo em conta o que foi descrito anteriormente, este trabalho tem como objetivo analisar o perfil transcriptómico de células endometeriais do corpo uterino de pacientes diagnosticados com cancro para determinadas condições descritas nos metadados de modo a realizar a análise da expressão diferencial com o intuito de compreender qual o efeito do fator no perfil transcriptómico das células e como esse perfil se traduz na gravidade da doença observada.
Os dados utilizados neste trabalho estão disponíveis em https://shorturl.at/wJZ34 e estão associados ao projeto "Uterine Corpus Endometrial Carcinoma TCGA PanCancer data"

## Extração dos dados de transcriptómica e respetivos metadados da base de dados

Com o objetivo de analisar os dados de transcriptómica referente ao carcinoma endométrio do corpo uterino, procedemos à extração da informação que se encontra presente no website cBioPortal onde se encontram disponibilizados, de forma gratuita, uma grande diversidade de alterações genómicas de vários tipos de cancro, incluindo o cancro selecionado para estudo. Para esse efeito recorremos ao package TCGAbiolinks, uma vez que este possibilita a interação com a base de dados cBioPortal e apresenta várias funções que possibilitam realizar queries à base de dados filtrando os datasets que se seleciona para proceder, posteriormente, ao seu download

```{r,results= 'markup'}
#query_UCEC = GDCquery(
  #project = "TCGA-UCEC",
  #data.category = "Transcriptome Profiling", 
  #data.type = "Gene Expression Quantification",
  #workflow.type = "STAR - Counts"
#)


#GDCdownload(query=query_UCEC)


#rna_seq_UCEC = GDCprepare(query = query, save = TRUE, save.filename = "mRNA_TCGA-UCEC.rda")
rna_seq_UCEC = get(load("mRNA_TCGA-UCEC.rda"))
```

A função GDCquery() é utilizada para realizar a query à base dados. Nesta função são definidos vários parâmetros que permitem filtrar o data set que posteriormente vai ser descarregado. O parâmetro "project" corresponde ao id atribuído ao tipo de cancro de modo a apenas considerar a informação disponível referente ao carcinoma endométrio do corpo uterino. A "data.category" é usado para especificar a categoria de dados que se pretende selecionar, neste caso, como pretendemos realizar a análise da transcriptómica selecionou-se a categoria "Transcriptome Profiling" para selecionar os dados relacionados com o perfil de expressão de genes. De entre os dados do perfil de expressão de genes restringiu-se apenas aos dados referentes à quantificação da expressão de genes definindo "data.type" como Gene expression quantification. Por fim, indicou-se o tipo de análise da expressão genética desejada, optando-se por recorrer ao START-Counts. Este workflow indica que o algoritmo utilizado para a contagem da expressão genética a partir do alinhamento das sequências foi realizada com a ferramenta STAR.

A função GDCdownload() é utilizada para realizar o download dos dados consoante a query realizada e estabelecida na função anterior. Em seguida, recorreu-se à função GDCprepare() com o intuito de gerar um objeto "SummarizedExperiment" de modo a compilar a informação descarregada num único objeto de modo a facilitar a análise dos dados. É de notar que a função também permite gravar os dados em formato "rdata" de modo a facilitar o carregamento dos dados através da função load(). É importante referir que a utilização deste workflow permite o download simultaneo quer dos dados da expressão genética quer dos metadados associados às amostras e aos genes.

## Análise inicial dos dados

Nesta fase procedeu-se à exploração incial dos dados de forma a perceber a dimensão dos dados correspondente à expressão genética bem como dos metadados.

```{r, echo=TRUE}
#retorna a classe e a dimensão da estrutura de dados
class(rna_seq_UCEC);dim(rna_seq_UCEC)


#extracao dos metadados associados às das linhas
dim(SummarizedExperiment::rowData(rna_seq_UCEC));colnames(SummarizedExperiment::rowData(rna_seq_UCEC))


#extracao dos metadadosassociados às colunas
dim(SummarizedExperiment::colData(rna_seq_UCEC));rownames(SummarizedExperiment::colData(rna_seq_UCEC))[1:5]
```
Através da análise feita acima é possível verificar que o nosso dataset é um objeto "SummarizedExperiment" que possui 60660 linhas e 589 colunas. Com a extração dos metadados associados as linhas podemos concluir que as linhas do objeto correspondem aos genes, sendo que, para cada gene, existem 10 metadados associados a cada gene incluindo o gene_id que corresponde a um código único utilizado pela base de dados Ensembl para a identificação dos varios genes.
Por outro lado, as colunas possuem 78 metadados que possibilitam a caracterização das 589 amostras utilizadas neste estudo permitindo analisar o impacto que as diferentes características possuem nos dados de expressão genética.
É importante referir que os metadados associados às colunas passam a ter uma apresentação diferente, isto é, as linhas passam a ser identificadas com o id da amostra enquanto no objeto original as linhas são identicadas pelo id do gene

## Preparação e pre-processamento dos dados
Nesta etapa preparamos o dataset para ser, posteriormente submetido a análise de expressão diferencial e de enriquecimento. Para esse efeito, optamos por separar os dados referentes à expressão genética e a informação relativa aos metadados do objeto incial para posteriormente realizar a filtragem dos dados.


```{r extração da informação}
# extração da informação da expressão de genes
geneExp = SummarizedExperiment::assay(rna_seq_UCEC)


# extração dos metadados referentes às amostras
amostras_metadados = colData(rna_seq_UCEC) 
metadados_reduzido=amostras_metadados[,c("paper_tumor_grade","paper_age","paper_race")]
```


```{r análise exploratória dos dados,fig.align='center}
table(is.na(geneExp))


summary(as.data.frame(metadados_reduzido))
hist(metadados_reduzido$paper_age, main= "Idade dos pacientes em estudo", xlab="Idade", ylab="Frequência absoluta",col="orange")

boxplot(metadados_reduzido$paper_age~metadados_reduzido$paper_tumor_grade,horizontal=T)


```

##################################

# Bibliografia

1. Sung H, Ferlay J, Siegel RL, Laversanne M, Soerjomataram I, Jemal A, Bray F. Global Cancer Statistics 2020: GLOBOCAN Estimates of Incidence and Mortality Worldwide for 36 Cancers in 185 Countries. CA Cancer J Clin. 2021 May;71(3):209-249. \doi: 10.3322/caac.21660. 

2. Creasman WT, Odicino F, Maisonneuve P, Quinn MA, Beller U, Benedet JL, Heintz A, Ngan H, Pecorelli S. Carcinoma of the Corpus Uteri. Int J Gynaecol Obstet. 2006 Nov;95 Suppl 1:S105-S143. \doi: 10.1016/S0020-7292(06)60031-3.

3. Leslie KK, Thiel KW, Goodheart MJ, De Geest K, Jia Y, Yang S. Endometrial cancer. Obstet Gynecol Clin North Am. 2012 Jun;39(2):255-68. \doi: 10.1016/j.ogc.2012.04.001.
