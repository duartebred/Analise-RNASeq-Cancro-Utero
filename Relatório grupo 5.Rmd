---
title: "Carcinoma do endométrio do corpo uterino"
output:
  html_document:
    toc: true
    toc_float: true
  pdf_document: default
encoding: "UTF-8"
---
<style>
  p {
    text-align: justify;
  }
</style>

```{r setup, include=FALSE, warning = FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Este trabalho prático foi desenvolvido pelos elementos Duarte Velho(pg53841), Joana Lopes(pg53498), João Ferreira(pg52182), Ricardo Oliveira(pg53501), no âmbito da UC Extração de Conhecimentos de Dados Biológicos (2023/24), do Mestrado em Bioinformática da Escola de Engenharia da Universidade do Minho, e tem como objetivo principal analisar, através das ferramentas R e packages do Bioconductor, um conjunto de dados, acedidos a partir do cBioPortal, relacionados com o Carcinoma Endometrial do Corpo Uterino. Será dividido em duas fases principais.

## 1ª Fase

A primeira fase deste trabalho será consituida pelas seguintes etapas: explicação dos dados, sua origem e relevância ; tarefas de preparação e de pré-processamento dos dados; sumarização dos dados (estatística descritiva, exploração com recurso a gráficos); análise estatística univariada e análise de expressão diferencial e de enriquecimento.

### Instalação e importação de packages

Nesta secção são destacados todos os packages utilizados no trabalho, que facilitam a aquisição e análise de dados ao longo do documento, tornando mais eficiente a obtenção e compreensão das informações relevantes.

```{r, results='hide', warning = FALSE, message=FALSE}
#install.packages("BiocManager")
#install.packages("jpeg")
#install.packages("TCGAbiolinks")
#install.packages("Biobase")
#install.packages("DESeq2")
#install.packages("ggbeeswarm")
#install.packages("genefilter")
#install.packages("pheatmap")
#install.packages("org.Hs.eg.db")
#install.packages("fgsea")
#install.packages("ggplot2")
#install.packages("xfun")
#install.packages("SummarizedExperiment") 
#install.packages("factoextra")
#install.packages("Rtsne")
#install.packages("EBImage")
```

```{r,results='hide', warning = FALSE, message=FALSE}
#library("jpeg")
#library("TCGAbiolinks")
#library("SummarizedExperiment")
#library("DESeq2")
#library("Biobase")
#library("DESeq2")
#library("ggbeeswarm")
#library("pheatmap")
#library("org.Hs.eg.db")
#library("fgsea")
#library("ggplot2")
#library("factoextra")
#library("limma")
#library("genefilter")
#library("Rtsne")
#library("party")
#library("rpart")
#library("caret") 
#library("rsample")

```

### **1.Introdução**

#### 1.1 Enquadramento

Nos dias de hoje, o cancro é uma das principais causas de morte a nível mundial, sendo que, segundo a Organização Mundial da Saúde (OMS), em 2020, foram diagnosticados cerca de 19,3 milhões de novos casos de cancro, que resultaram na morte, de aproximadamente 10 milhões de pessoas [1].
O preocupante aumento da incidência do cancro ao longo das ultimas décadas levou ao surgimento de iniciativas, tal como a PanCancer Atlas, que visam encontrar respostas para as grandes e abrangentes questões sobre o cancro, através da análise de tumores caracterizados no conjunto de dados resultantes do projeto de The Cancer Genome Atlas (TCGA).
O TCGA é um programa de genómica de referência na área do cancro que, em colaboração com o Instituto Nacional do Cancro (NCI) e o Instituto Nacional de Pesquisa do Genoma Humano (NHGRI) dos Estados Unidos, caracterizou mais de 20 mil cancros primários abrangendo 33 tipos de cancro.
Os tipos de cancro selecionados para estudo cumprem requisitos tais como ter um mau prognóstico, ter um impacto geral na saúde pública, disponibilidade de amostras com a qualidade e quantidade desejadas, entre outros.
(National Cancer Institute, 2022)

O cancro endometrial do corpo uterino, um dos cancros incluídos no TCGA, é o sétimo tumor maligno mais frequente no mundo e o quarto mais comum na mulher sendo a doença ginecológica maligna mais prevalente, tendo provocado em 2011 mais de 8 mil mortes [2,3].
De todos os cancros do corpo uterino mais de 83% correspondem a carcinomas do endométrio, enquanto apenas 10% dos diagnósticos são classificados como sarcomas [2].
Este tipo de cancro tem ganho maior atenção por parte da comunidade científica, uma vez que se verificou um aumento da sua incidência com a agravante de que a taxa de sobrevivência aos 5 anos é consideravelmente menor, em comparação com o ano de 1975, passando de 88% para cerca de 84%, em 2006, indicando um aumento na mortalidade [3].
A taxa de sobrevivência está fortemente correlacionada com o estádio da doença aquando do diagnóstico, sendo que para pacientes no estádio inicial se considera curável atingindo cerca de 96% de sobrevivência.
No entanto, para fases mais avançadas e de alto grau, é considerado letal reduzindo drasticamente a taxa de sobrevivência de 96% para 17%.(Costa & Cunha, n.d.)


```{r,echo=FALSE,results= 'markup', warning=FALSE, fig.cap= "Fig 1- Anatomia do sistema reprodutor feminino (Adaptdado de American Society Cancer)",fig.align='center'}
library(jpeg)
image=readJPEG("cancro_endometrial.jpg")
# Definir margens para zero
par(mar = c(0, 0, 0, 0))  # margens inferior, esquerda, superior, direita
# Criar um gráfico sem eixos
plot(0, 0, type = "n", xlim = c(0, 1), ylim = c(0, 1), xlab = "", ylab = "", axes = FALSE)
rasterImage(image, 0, 0, 1, 1)
```

#### 1.2. Objetivo

Com base na problemática apresentada, este trabalho tem como objetivo analisar o perfil transcriptómico de células endometeriais do corpo uterino de pacientes diagnosticados com cancro para determinadas condições descritas nos metadados, de modo a realizar a análise da expressão diferencial com o intuito de compreender qual o efeito do fator no perfil transcriptómico das células e como esse perfil se traduz na gravidade da doença observada.
Os dados utilizados neste trabalho estão disponíveis no [GDC DataPortal](https://shorturl.at/fmpJ5).

### **2.Extração dos dados de transcriptómica e respetivos metadados da base de dados**

#### 2.1. Obtenção dos dados

Com o objetivo de analisar os dados de transcriptómica referente ao carcinoma endometrial do corpo uterino, procedemos à extração da informação que se encontra presente no website cBioPortal, onde se encontram disponibilizados, de forma gratuita, uma grande diversidade de alterações genómicas de vários tipos de cancro, incluindo o cancro selecionado para estudo.
Para esse efeito recorremos ao package TCGAbiolinks, uma vez que este possibilita a interação com a base de dados GDC DataPortal e apresenta várias funções que possibilitam realizar queries à base de dados filtrando os ficheiros que se pretende selecionar para proceder, posteriormente, ao seu download.

```{r,results= 'markup'}
#query_UCEC = GDCquery(
#  project = "TCGA-UCEC",
#  data.category = "Transcriptome Profiling", 
#  data.type = "Gene Expression Quantification",
#  workflow.type = "STAR - Counts"
#)
#GDCdownload(query=query_UCEC)
#rna_seq_UCEC = GDCprepare(query = query_UCEC, save = TRUE, save.filename = "mRNA_TCGA-UCEC.rda")
rna_seq_UCEC = get(load("mRNA_TCGA-UCEC.rda"))
```

A função **GDCquery()** é utilizada para realizar a query à base dados.
Nesta função são definidos vários parâmetros que permitem filtrar o data set que posteriormente vai ser descarregado.
O parâmetro "project" corresponde ao id atribuído ao tipo de cancro de modo a apenas considerar a informação disponível referente ao carcinoma endométrio do corpo uterino.
A "data.category" é usado para especificar a categoria de dados que se pretende selecionar, neste caso, como pretendemos realizar a análise da transcriptómica selecionou-se a categoria "Transcriptome Profiling" para selecionar os dados relacionados com o perfil de expressão de genes.
De entre os dados do perfil de expressão de genes restringiu-se apenas aos dados referentes à quantificação da expressão de genes definindo "data.type" como Gene expression quantification.
Por fim, indicou-se o tipo de análise da expressão genética desejada, optando-se por recorrer ao START-Counts.
Este workflow indica que o algoritmo utilizado para a contagem da expressão genética a partir do alinhamento das sequências foi realizada com a ferramenta STAR.

A função **GDCdownload()** é utilizada para realizar o download dos dados consoante a query realizada e estabelecida na função anterior.
Em seguida, recorreu-se à função **GDCprepare()** com o intuito de gerar um objeto "SummarizedExperiment" de modo a compilar a informação descarregada num único objeto de modo a facilitar a análise dos dados.
É de notar que a função também permite gravar os dados em formato "rdata" de modo a facilitar o carregamento dos dados através da função **load()**.
É importante referir que a utilização deste workflow permite o download simultâneo quer dos dados da expressão genética quer dos metadados associados às amostras e aos genes.

#### 2.2. Análise inicial dos dados

Nesta fase procedeu-se à exploração incial dos dados de forma a perceber a dimensão dos dados correspondentes à expressão genética bem como dos metadados.

```{r, echo=FALSE, results='markup', warning=FALSE, message=FALSE}
# analise da estrutura dos dados descarregados
# Comando cat() para exibir tudo  num bloco


cat("Class of rna_seq_UCEC:", class(rna_seq_UCEC), "\n")
cat("Dimensions of rna_seq_UCEC:", paste(dim(rna_seq_UCEC)[1], "x", dim(rna_seq_UCEC)[2]), "\n")
cat("First 5 column names of rna_seq_UCEC:", paste(colnames(rna_seq_UCEC)[1:5], collapse=", "), "\n")
cat("First 5 row names of rna_seq_UCEC:", paste(rownames(rna_seq_UCEC)[1:5], collapse=", "), "\n")


cat("\n")

# análise dos metadados
linhas_metadados=SummarizedExperiment::rowData(rna_seq_UCEC)
amostras_metadados = SummarizedExperiment::colData(rna_seq_UCEC)

cat("Class of linhas_metadados:", class(linhas_metadados), "\n",
    "Class of amostras_metadados:", class(amostras_metadados), "\n","Dimensions of linhas_metadados:", paste(dim(linhas_metadados), collapse=" x "), "\n",
    "Dimensions of amostras_metadados:", paste(dim(amostras_metadados), collapse=" x "), "\n",
    "First 5 column names of linhas_metadados:", paste(colnames(linhas_metadados)[1:5], collapse=", "), "\n",
    "First 5 column names of amostras_metadados:", paste(colnames(amostras_metadados)[1:5], collapse=", "), "\n")
```

Através da análise feita acima é possível verificar que o nosso dataset é um objeto **SummarizedExperiment** que possui 60660 linhas e 589 colunas.
Com a extração dos metadados associados às linhas podemos concluir que as linhas do objeto correspondem aos genes, sendo que, para cada gene, existem 10 metadados associados incluindo o gene_id que corresponde a um código único utilizado pela base de dados Ensembl para a identificação dos varios genes.
Por outro lado, as colunas possuem 78 metadados que possibilitam a caracterização das 589 amostras utilizadas neste estudo permitindo analisar o impacto que as diferentes características possuem nos dados de expressão genética.
É importante referir que os metadados associados às colunas passam a ter uma apresentação diferente, isto é, as linhas passam a ser identificadas com o id da amostra enquanto no objeto original as linhas são identicadas pelo id do gene.

#### 2.3. Preparação e pre-processamento dos dados
Nesta etapa preparamos o dataset para ser, posteriormente, submetido a análise de expressão diferencial e de enriquecimento.
Para esse efeito, optamos por separar os dados referentes à expressão genética e a informação relativa aos metadados do objeto inicial para depois realizar a filtragem dos dados.

```{r extração da informação}
#extração da informação da expressão de genes
geneExp = SummarizedExperiment::assay(rna_seq_UCEC)
```

Com o package **SummarizedExperiment** armazenamos os dados de contagens de sequenciamento de RNA, bem como outros tipos de dados experimentais ómicos, juntamente com metadados relevantes.
Esses dados de expressão genética extraídos são armazenados na variável geneExp.
O comando **assay()** é usado para extrair a matriz de contagens (ou matriz de expressão) do objeto SummarizedExperiment.
Esta matriz contém os dados numéricos de expressão para cada gene em cada amostra, que são essenciais para análises subsequentes, como normalização, análise de expressão diferencial, e outras análises ômicas.

#### 2.4. Pre-processamento e filtragem dos metadados

Com o intuito de fazer uma filtragem dos metadados, uma vez que é comum a existência de valores omissos, procedeu-se procedeu-se à diminuição do número de colunas associadas aos metadados, eliminando-se as colunas que possuem mais de 10% de valores omissos.
Com esta abordagem vamos eliminar metadados que, por possuirem um número de NAs que definimos como limite, não constituem interesse para o nosso estudo.
Assim, removemos as colunas dos metadados onde havia mais de 60 elementos como: "not/Not reported/Reported" e/ou "NA.

```{r, echo=TRUE}

# remoção de colunas com mais de 10% de valores omissos
rm_not_reported = which(sapply(amostras_metadados,function(x) sum(x == "not reported", na.rm = TRUE)) > 60)
rm_Not_Reported = which(sapply(amostras_metadados,function(x) sum(x == "Not Reported",na.rm = TRUE)) > 60)
rm_nas = which(sapply(amostras_metadados, function(x) sum(is.na(x))) > 60)
amostras_meta_reduzido = amostras_metadados[, -c(rm_not_reported, rm_Not_Reported, rm_nas)]
dim(amostras_meta_reduzido)
```

Com esta filtragem obtivemos 50 colunas, em vez das 78 iniciais.É possível realizar uma filtragem ainda mais profunda dos metadados, porém estabeleceu-se nesta fase inicial uma percentagem fixa de valores omissos a eliminar.

#### 2.5. Análise Descritiva e Exploratória
Para o nosso estudo, de entre as 50 colunas de metadados filtradas, selecionamos 4 variáveis de caraterísticas distintas, nomeadamente as colunas "vital_status", "primary_diagnosis", "age_at_index", "figo_stage", procedendo ainda a uma transformação desta última coluna que será explicada adiante.
```{r, echo=FALSE}
# seleção apenas das colunas de interesse e transformação da coluna figo_stage
amostras_meta_reduzido = amostras_meta_reduzido[,c("vital_status","primary_diagnosis","age_at_index","figo_stage")]
amostras_meta_reduzido$figo_stage = gsub(".*\\b(Stage [VI]+).*", "\\1", amostras_meta_reduzido$figo_stage)

```

#### - Estado Vital
A coluna "vital_status", incorpora uma variável nominal e dá-nos informações sobre a sobrevivência do paciente com cancro e apresenta 3 categorias possívies: "Alive", "Dead", "NA". Neste caso verificamos que, no momento de recolha dos dados, dos 589 pacientes, aproximadamente 81% estavam vivos e 16% tinham falecido, acerca dos restantes não havia informação disponível, sendo reportados como "NAs".

```{r, echo=FALSE}
# vital_status
tabela_vital = prop.table(table(amostras_meta_reduzido$vital_status, useNA = "ifany")) *100
barplot(tabela_vital, names.arg= c("Alive","Dead","NAs"), col= "lightblue", ylab="Percentagem",
        main="Estado Vital")
```

#### - Diagnóstico Primário
A coluna "primary_diagnosis", corresponde a uma variável nominal, e descreve o diagnóstico histológico do paciente, de acordo com a Classificação Internacional de Doenças para Oncologia (International Classification of Diseases for Oncology, ICD-O)  da Organização Mundial da Saúde. Apresenta 8 categorias possíveis "Adenocarcinoma, NOS","Carcinoma, undifferentiated, NOS","Clear cell adenocarcinoma, NOS","Endometrioid adenocarcinoma, NOS","Endometrioid adenocarcinoma, secretory variant","Papillary serous cystadenocarcinoma","Serous cystadenocarcinoma, NOS","Serous surface papillary carcinoma". A desginação "NOS", Not Otherwise Specified, apenas indica que com base nas informações disponíveis, um determinado tipo de cancro não pode ser encaixado noutra categoria mais específica. Verificamos que os dados vão de encontro à literatura, identificando o adenocarcinoma do endométrio como prevalente neste estudo, com cerca de 71.8% de pacientes diagnosticados com este tipo de cancro do corpo uterino. Logo de seguida temos 24.3% de pacientes com cistadenocarcinomas serosos e 3.9% com outros tipos de cancro que agrupamos na categoria "Outros", incluindo os casos em que não se sabe a categoria("NA"). 
```{r, echo=FALSE}
# primary_diagnosis
tabela_primary = prop.table(table(amostras_meta_reduzido$primary_diagnosis, useNA = "ifany")) * 100
outros = sum(tabela_primary[c(1, 2, 3, 5, 6, 8, 9)])
primary_comprimido = matrix(c(outros, tabela_primary[4], tabela_primary[7]), ncol = 3,
    dimnames = list(NULL, c("Outros", "Endometrioid adenocarcinoma, NOS", "Serous cystadenocarcinoma, NOS")))
labels_primary <- c("Outros", "Endometrioid adenocarcinoma, NOS", "Serous cystadenocarcinoma, NOS")
pie(primary_comprimido, labels = paste(labels_primary, sprintf("%.1f%%", primary_comprimido)),
    col = c('lightgreen', 'lightblue', 'lightpink'), main = "Distribuição de Diagnósticos Primários")

```

#### - Estádio FIGO
A coluna  "figo_stage",  incorpora uma variável ordinal que representa o estádio do cancro, nomeadamente no que diz respeito à sua extensão, especialmente se a doença se espalhou do local original para outras partes do corpo, conforme descrito pelos estádios da Federação Internacional de Ginecologia e Obstetrícia (FIGO) [4]. Originalmente, esta classificação está dividia em 4 estádios principais, nomeadamente, estádio I onde o tumor está confinado ao corpo uterino, estádio II onde já existe envolvimento do cérvix/colo uterino, estádio III que representa um atingimento de estruturas adjacentes do mesmo orgão como por exemplo os gânglios linfáticos da zona pélvica e, por último, o estádio IV onde já existem metásteses noutros orgãos como por exemplo no intestino. Para além desta classificação em 4 estádios gerais, cada um destes estádios se encontra subdividido em dois ou mais estádios consoante a extensão a outras estrututras. Neste estudo, para conseguirmos visualizar os dados de forma mais eficiente, e dado o objetivo deste trabalho, decidimos proceder a uma transformação desta coluna, agrupando os diferentes sub-estádios nas suas 4 categorias principais. Desta forma, esta variável toma 4 níveis "STAGE I", "STAGE II", "STAGE III" e "STAGE IV", sendo que 60.3% das amostras são de tumores em "STAGE I", 9.2% em "STAGE II", 23.3% em "STAGE III", 5.3% em "STAGE IV" e exitem ainda 2% de amostras que não possuem classificação quanto ao estádio. Ou seja, mais de metade dos tumores em estudo são confinados ao corpo uterino, e uma parte considerável correspondem a tumores mais agressivos, com atingimento de estruturas adjacentes ao orgão reprodutor feminino (23.3%) ou com atingimento de outros orgãos (5.3%).
```{r, echo=FALSE}
# figo_stage
tabela_figo = prop.table(table(amostras_meta_reduzido$figo_stage,  useNA = "ifany")) *100
labels_figo = c("Stage I", "Stage II", "Stage III", "Stage IV", "NAs")
pie(tabela_figo, labels = paste(labels_figo, sprintf("%.1f%%", tabela_figo)), col=c('lightblue','lightgreen',
    'yellow','lightpink','orchid'), main= "Distribuição de Estágios de Cancro Ginecológico (FIGO)")

```

#### - Idade dos Pacientes
A coluna "age_at_index", corresponde a uma variável proporcional contínua, e representa a idade dos pacientes do estudo. Podemos verificar que a idade dos pacientes varia entre os 31 e os 90 anos, sendo que a maioria das idades está compreendida entre os 57 e os 71 anos e metade dos pacientes têm 64 ou menos anos. De acresentar que existem 15 pacientes acerca dos quais não se sabe a idade.
```{r, echo=FALSE}
# age_at_index
idade_pacientes = amostras_meta_reduzido$age_at_index
summary(idade_pacientes)
#par(mfrow = c(2, 1))
boxplot(idade_pacientes,horizontal=F, col = "purple", main='Histograma da idade dos pacientes')
hist(idade_pacientes, xlab = 'Idade dos Pacientes', ylab = 'Frequência', main = 'Histograma da Idade dos Pacientes',
     col='lightblue')

```
```{r, echo=FALSE}
cat("\n")
```

Dado que verficamos a presença de alguns NAs, na fase de realização dos testes de hipóteses, decidimos eliminar as linhas, ou seja, os pacientes, sobre os quais não tínhamos informações relativas aos metadados selecionados. Esta trasnformação culminou num total de 574 pacientes em estudo em vez dos 589 iniciais.
```{r, include=FALSE}
metados_sem_nas = na.omit(as.data.frame(amostras_meta_reduzido))
dim(metados_sem_nas) # passamos de 589 para 574
```


#### 3.3. Testes de hipótese
###### **Nota:** para todos os testes estatísticos abaixo realizados, considere-se um valor de prova igual a 0.05.

Ainda dentro da análise exploratória dos dados, através do boxplot "Idade do Paciente por Estádio FIGO" conseguimos, visualmente, constatar que a mediana das idades em pacientes com tumor no estádio IV é maior que as restantes, o que pode indicar uma relação entre a idade avançada e o estádio do tumor no que diz respeito à sua gravidade. Entre os restantes estádios não se verifica, visualmente, uma diferença tão notória na mediana.

```{r, echo=FALSE}
#idade dos pacientes em função do estádio FIGO
boxplot(metados_sem_nas$age_at_index~metados_sem_nas$figo_stage, horizontal = T,
        xlab="Idade do paciente", ylab="Estádio FIGO", main= "Idade do Paciente por Estádio FIGO",
        col=c("lightcoral","indianred","tomato",'red')) #verificação visual dos vários grupos
```

Passando aos testes estatísticos, para as hipóteses definidas como:
<div style="text-align: center;">
H0: Não existem diferenças significativas na média das idades dos pacientes entre os diferentes estádios.
H1: Existem ou não diferenças significativas na média das idades dos pacientes entre os diferentes estádios.
</div>

através do **shapiro.test()** verificamos que os dados da variável "age_at_index" não são normais (p.value<0.05). No entanto, através da análise do Q-Q Plot, com sobreposição da linha qqline, verificamos que os pontos estão, na sua maioria, sobrepostos à linha diagonal e apenas as extremidades se afastam abaixo e acima da diagonal. Para além disso, estamos perante um grande volume de dados (n=574), ou seja, de acordo com o teorema do limite central, podemos aceitar a normalidade dos dados apesar de o valor de p-value do teste de shapiro nos levar a rejeitar a hipótese nula. Garantindo a normalidade e a homogenidade das variâncias, procedemos à análise **anova one way** para verificarmos se existem ou não diferenças significativas na média das idades dos pacientes entre os diferentes estádios e obtivemos um valor de prova de 0.722, o que nos leva a não rejeitar a hipótese nula, ou seja, não há diferenças significativas na média das idades dos pacientes entre os diferentes estádios.


```{r, echo=FALSE}
shapiro.test(metados_sem_nas$age_at_index) # teste à normalidade dos dados
qqnorm(metados_sem_nas$age_at_index) # visualização da normalidade através do gráfico qqplot
qqline(metados_sem_nas$age_at_index)
```

```{r, echo=FALSE}
# Teste de Bartlett para verificar homogeneidade das variâncias
#H0: as variâncias são homogénas
#H1: as variâncias não são homogénas
bartlett.test(metados_sem_nas$age_at_index ~ metados_sem_nas$figo_stage)
```


```{r, echo=FALSE}
#H0: Não há diferença estatisticamente significativa na média das idades dos pacientes entre os diferentes estádios FIGO
#H1: Há diferença estatisticamente significativa na média das idades dos pacientes entre os diferentes estádios FIGO
aov_FIGO = aov(metados_sem_nas$age_at_index~metados_sem_nas$figo_stage)
summary(aov_FIGO)
boxplot(aov_FIGO$residuals, horizontal = T, main= "Análise dos resíduos- estádio FIGO" ) # verificação da homogeneidade das variâncias
```

Ainda assim, procedemos à realização do teste não paramétrico **kruskal.test()** para vermos se os resultados seriam os mesmos e, mais uma vez, obtivemos um valor de prova de 0.6632 que não nos permite rejeitar a hipótese de que não há diferenças significativas na média das idades dos pacientes entre os diferentes estádios.

```{r}
kruskal.test(metados_sem_nas$age_at_index~metados_sem_nas$figo_stage) # teste não parametrico
```
<div style="text-align: center;">
No que diz respeito ao estado de sobrevivência dos pacientes, vital_status, visualmente é transmitida a ideia de que os pacientes que já faleceram tinham uma idade mais avançada. Através do teste anova one way,para as hipóteses definidas como:

H0: Não existem diferenças significativas na média das idades dos pacientes entre os diferentes estados de vida.
H1: Existem ou não diferenças significativas na média das idades dos pacientes entre os diferentes estados de vida.

verificamos que a hipótese nula é rejeitada ( p value= 6.13e-05), ou seja, existem diferenças estatisticamente significativas entre a idade dos pacientes nos diferentes grupos "Alive" e "Dead".
</div>
```{r, echo=FALSE}
#idade dos pacientes em função do estado vital
# Teste de Bartlett para verificar homogeneidade das variâncias
#H0: as variâncias são homogénas
#H1: as variâncias não são homogénas
bartlett.test(metados_sem_nas$age_at_index ~ metados_sem_nas$vital_status)
```

```{r, echo=FALSE}
boxplot(metados_sem_nas$age_at_index~metados_sem_nas$vital_status, horizontal = T,
        xlab="Idade do paciente", ylab="Estado Vital", main= "Idade do Paciente por Estado Vital",
        col=c("lightgreen","gray"))
```


```{r, echo=FALSE}
aov_estado_vital = aov(metados_sem_nas$age_at_index~metados_sem_nas$vital_status)
summary(aov_estado_vital)
boxplot(aov_estado_vital$residuals, horizontal = T , main= "Análise dos resíduos- estado vital") # verificação da homogeneidade das variâncias
```

Realizamos também para este caso o teste não paramétrico kruskal.test() e obtivemos um valor de prova de 0.0001071 que nos permite rejeitar a hipótese de que não há diferenças significativas na média das idades dos pacientes entre os diferentes estados de vida ("Alive" e "Dead").

```{r, echo=FALSE}
kruskal.test(metados_sem_nas$age_at_index~metados_sem_nas$vital_status) # teste não parametrico
```

### **3.Análise de expressão diferencial e enriquecimento**

Com o intuito de proceder à análise dos genes que se encontram diferencialmente expressos no tumor "Endometrioid adenocarcinoma, NOS"  em função do estado vital do paciente em estudo procedeu-se ao pre-processamento dos dados de modo a facilitar e otimizar a análise diferencial reduzindo o tempo e os recursos computacionais necessários.
Numa primeira fase realizou-se a filtragem das amostras que são descritas nos metadados como tendo diagnóstico primário de Endometrioid adenocarcinoma, NOS, já que apenas estas amostras representam relevância para este estudo. Em seguida, avaliou-se a eventual presença de valores omissos ao nível da coluna do estado vital e, uma vez que não existem valores omissos, transformou-se o metadado "vital_status" em fator, visto que a análise de expressão diferencial realizada pelo package DESeq2 recomenda a utilização de fatores ao invés de caracteres.

Embora se tenha realizada uma filtragem ao nível das amostras, uma vez que o dataset possui cerca de 61 mil genes analisados, é importante que se realiza uma filtragem de modo a remover genes que apresentam expressão ausente, isto é, genes que não possuem nenhuma amostra com expressão. Além disso, é também interessante remover genes que possuem uma baixo nível de expressão, uma vez que estes genes não permitem retirar informações relevantes acerca da expressão diferencial.
Para isso eliminou-se do dataset todos aqueles genes que não possuíam pelo menos 20 counts em pelo menos 4 amostras, sendo que estes parâmetros são considerados standard, segundo o workflow apresentado na documentação do [DESeq2] https://shorturl.at/nyLT0.
Após a etapa do pre-processamento, o dataset final apresenta cerca de 28 mil genes e 423 amostras.

```{r}
dados_sem_nas = rna_seq_UCEC[,!is.na(rna_seq_UCEC$primary_diagnosis)]
amostras_EA = dados_sem_nas$primary_diagnosis == "Endometrioid adenocarcinoma, NOS" 
dados_EA = dados_sem_nas[,amostras_EA]

sum(is.na(dados_EA$vital_status))
gene_exp_filtrado$vital_status = factor(gene_exp_filtrado$vital_status)
ddsSE = DESeqDataSet(gene_exp_filtrado, design = ~ vital_status)


genes_manter = rowSums(counts(ddsSE) >= 20) >= 4
ddsSE = ddsSE[genes_manter, ]
dim(ddsSE)

```

Em seguida procedeu-se à utilização da função DESeq() para realizar os testes de expressão diferencial. Esta função 


Através do package DESeq2 procedemos à realização do teste de expressão diferencial (... falar da normalização).
Ao aplicarmos o comando summary() aos resultados da expressão diferencial obtemos a informação de que estão a ser diferencialmente expressos um total de 3431 genes, sendo que cerca de 8.4% estão a ser sobre-expressos e cerca de 4.1% estão a ser subexpressos. Graficamente, através do MA plot, conseguimos visualizar essa diferença na expressão dos genes, sendo que os pontos a azul correspondem aos genes diferencialmente expressos e os pontos a cinza correspondem a outros genes. Para os genes sobre-expressos temos então uma condição em que esses genes estão mais expressos na condição "Dead" do que na condição "Alive" e para os genes sub-expressos temos o inverso, ou seja, os genes em questão estão sub-expressos na condição "Alive".
Através da função plotCounts() fizemos a análise de expressão diferencial de um dos genes mais diferencialmente expressos, e podemos retirar as seguintes conclusões: a expressão desse gene



```{r}

ddsSE_norm = DESeq(ddsSE)
resultados = results(ddsSE_norm, alpha = 0.05)

```

### Bibliografia

1.  Sung H, Ferlay J, Siegel RL, Laversanne M, Soerjomataram I, Jemal A, Bray F. Global Cancer Statistics 2020: GLOBOCAN Estimates of Incidence and Mortality Worldwide for 36 Cancers in 185 Countries.
    CA Cancer J Clin.
    2021 May;71(3):209-249.
    \doi: 10.3322/caac.21660.

2.  Creasman WT, Odicino F, Maisonneuve P, Quinn MA, Beller U, Benedet JL, Heintz A, Ngan H, Pecorelli S. Carcinoma of the Corpus Uteri.
    Int J Gynaecol Obstet.
    2006 Nov;95 Suppl 1:S105-S143.
    \doi: 10.1016/S0020-7292(06)60031-3.

3.  Leslie KK, Thiel KW, Goodheart MJ, De Geest K, Jia Y, Yang S. Endometrial cancer.
    Obstet Gynecol Clin North Am.
    2012 Jun;39(2):255-68.
    \doi: 10.1016/j.ogc.2012.04.001.
    
4.  Bhatla, N., Berek, J.S., Cuello Fredes, M., Denny, L.A., Grenman, S., Karunaratne, K., Kehoe, S.T., Konishi, I., Olawaiye, A.B., Prat, J. and Sankaranarayanan, R. 
Revised FIGO staging for carcinoma of the cervix uteri†.
  2019 Jan; 145: 129-135. 
    \doi: 10.1002/ijgo.12749
